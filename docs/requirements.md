# XPostAgent 要件定義書

**作成日**: 2025-01-09
**バージョン**: 1.1.0
**ステータス**: 実装完了

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
**XPostAgent** - X (Twitter) 自動投稿 Chrome 拡張機能

### 1.2 目的
Chrome拡張機能を通じて X（旧Twitter）への投稿作業を自動化し、ユーザーの投稿効率を向上させる。また、X の UI 変更に自動対応するセルフヒーリング機能により、継続的な運用を実現する。

### 1.3 背景
- X の投稿作業を効率化したい
- X の頻繁な UI 変更に手動対応するコストを削減したい
- 複数の投稿オプション（メディア、スケジュール等）を一括操作したい

---

## 2. スコープ

### 2.1 対象範囲（In Scope）
- Chrome 拡張機能の開発
- X への投稿機能（テキスト、メディア、オプション）
- Cloudflare Worker によるセレクタ管理
- セルフヒーリング機能（AI による DOM 解析）

### 2.2 対象外（Out of Scope）
- X 以外の SNS プラットフォーム対応（将来拡張予定）
- X の分析・レポート機能
- 複数アカウントの同時管理（将来拡張予定）
- モバイルアプリ対応

---

## 3. 機能要件

### 3.1 投稿機能

| ID | 機能 | 優先度 | Phase | ステータス |
|----|------|--------|-------|-----------|
| F-001 | テキスト投稿 | 必須 | 1 | 完了 |
| F-002 | 公開範囲設定 | 必須 | 2 | 完了 |
| F-003 | 画像添付 | 必須 | 2 | 完了 |
| F-006 | アンケート作成 | 任意 | 2 | 完了 |
| F-007 | 絵文字挿入 | 任意 | 2 | 完了 |
| F-011 | ツリー投稿（スレッド） | 必須 | 2 | 完了 |
| F-012 | 投稿完了確認 | 必須 | 1 | 完了 |

### 3.2 セルフヒーリング機能

| ID | 機能 | 優先度 | Phase |
|----|------|--------|-------|
| H-001 | DOM 構造の差分検知 | 必須 | 3 |
| H-002 | セレクタのバージョン管理 | 必須 | 3 |
| H-003 | AI による新セレクタ生成 | 必須 | 3 |
| H-004 | セレクタの自動更新 | 必須 | 3 |
| H-005 | フォールバックセレクタ対応 | 必須 | 3 |

### 3.3 拡張機能 UI

| ID | 機能 | 優先度 | Phase |
|----|------|--------|-------|
| U-001 | ポップアップ UI | 必須 | 1 |
| U-002 | 投稿テキスト入力欄 | 必須 | 1 |
| U-003 | オプション選択 UI | 必須 | 2 |
| U-004 | ステータス表示 | 必須 | 1 |
| U-005 | エラー表示 | 必須 | 1 |

---

## 4. 非機能要件

### 4.1 パフォーマンス

| 項目 | 要件 |
|------|------|
| 投稿完了時間 | 5秒以内（ネットワーク遅延除く） |
| 拡張機能起動時間 | 1秒以内 |
| メモリ使用量 | 50MB以下 |

### 4.2 可用性

| 項目 | 要件 |
|------|------|
| セルフヒーリング成功率 | 90%以上 |
| エラーリトライ | 最大3回 |
| オフライン対応 | ローカルキャッシュ使用 |

### 4.3 セキュリティ

| 項目 | 要件 |
|------|------|
| API 認証 | API キーによる認証 |
| データ保護 | 投稿内容は Worker に送信しない |
| CORS 制限 | 拡張機能オリジンのみ許可 |

### 4.4 保守性

| 項目 | 要件 |
|------|------|
| ログ出力 | 4段階レベル（DEBUG/INFO/WARN/ERROR） |
| セレクタ履歴 | バージョン管理で保持 |
| ドキュメント | 仕様書・設計書の整備 |

---

## 5. 制約条件

### 5.1 技術的制約
- Chrome Manifest V3 準拠
- X のログイン状態が前提
- Cloudflare 無料プランの制限内

### 5.2 運用制約
- X の利用規約を遵守
- 過度な自動化による制限を回避
- テストアカウントでの検証必須

---

## 6. 前提条件

| 項目 | 前提 |
|------|------|
| ブラウザ | Google Chrome（最新版） |
| X アカウント | ログイン済み状態 |
| ネットワーク | インターネット接続必須 |
| Cloudflare | アカウント作成済み |

---

## 7. テストアカウント

| 項目 | 値 |
|------|-----|
| アカウント URL | https://x.com/UKi_yo4 |
| 用途 | 開発・テスト用 |

---

## 8. 実行フロー

```
1. ユーザーが X にログイン
      │
      ▼
2. Chrome 拡張機能を起動
      │
      ▼
3. ポップアップ UI で投稿内容を入力
   - テキスト入力
   - オプション選択（公開範囲、メディア等）
      │
      ▼
4. 「投稿」ボタンをクリック
      │
      ▼
5. Background SW が Cloudflare Worker からセレクタ取得
      │
      ▼
6. Content Script が X ページで DOM 操作実行
   - テキスト入力
   - オプション設定
   - ファイルアップロード
      │
      ▼
7. 投稿ボタンをクリック
      │
      ▼
8. 投稿完了を検知
      │
      ▼
9. ユーザーに結果を通知
```

---

## 9. 用語定義

| 用語 | 説明 |
|------|------|
| セレクタ | DOM 要素を特定する CSS セレクタ |
| セルフヒーリング | DOM 変更時に自動でセレクタを修正する機能 |
| KV | Cloudflare Key-Value ストレージ |
| Content Script | Web ページ上で動作する拡張機能スクリプト |
| Background SW | 拡張機能のバックグラウンド Service Worker |

---

## 10. 関連ドキュメント

| ドキュメント | ファイル | 説明 |
|-------------|---------|------|
| アーキテクチャ設計書 | `docs/architecture.md` | システム構成・データフロー |
| セレクタ定義書 | `docs/selectors.md` | DOM セレクタ一覧 |
| 機能仕様書 | `docs/functional-spec.md` | 機能詳細仕様 |

---

## 11. 更新履歴

| 日付 | バージョン | 変更内容 | 担当 |
|------|-----------|----------|------|
| 2025-01-09 | 1.0.0 | 初版作成 | - |
| 2025-01-10 | 1.1.0 | F-004,005,008,009,010削除、全機能実装完了 | - |
